{% extends "base.html" %}
{% block content %}
  <style>
    .grid{ display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:14px }
  </style>
  <div class="card">
    <h2>ðŸŒŒ Star Map</h2>
    <p class="muted">Pick a date, time and location. The map shows the sky above that place and moment.</p>
    <div class="grid" style="align-items:start; margin-top:10px">
      <form id="form" class="grid">
        <label>Date <input id="date" type="date" value="{{ default_date }}"></label>
        <label>Time <input id="time" type="time" value="{{ default_time }}"></label>
        <label>Latitude <input id="lat" type="number" step="0.0001" value="{{ default_lat }}"></label>
        <label>Longitude <input id="lon" type="number" step="0.0001" value="{{ default_lon }}"></label>
        <label>Title <input id="title" value="{{ default_title }}"></label>
        <label>Caption <input id="caption" value="{{ default_caption }}"></label>
        <button class="btn btn-primary" type="submit">Update</button>
      </form>

      <div>
        <img id="img" alt="Star Map" style="max-width:100%;border:1px solid var(--border);border-radius:12px"/>
        <div style="display:flex;gap:8px;margin-top:8px">
          <a id="dl" class="btn" download="starmap.png">Download PNG</a>
          <a class="btn" href="{{ url_for('secret') }}">Secret ðŸ’Œ</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    const img = document.getElementById('img');
    const dl  = document.getElementById('dl');
    function urlFor(){
      const q = new URLSearchParams({
        date: document.getElementById('date').value,
        time: document.getElementById('time').value,
        lat:  document.getElementById('lat').value,
        lon:  document.getElementById('lon').value,
        title:document.getElementById('title').value,
        caption:document.getElementById('caption').value
      });
      return "{{ url_for('starmap_png') }}?" + q.toString();
    }
    function refresh(){
      const u = urlFor();
      img.src = u + "&_=" + Date.now(); // bust cache
      dl.href = img.src;
    }
    document.getElementById('form').addEventListener('submit', (e)=>{ e.preventDefault(); refresh(); });
    refresh();
  </script>
{% endblock %}
